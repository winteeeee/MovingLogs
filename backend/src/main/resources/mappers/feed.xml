<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.ssafy.enjoytrip.feed.dao.FeedDao">
 	<select id="searchPostsWithPaging">
		SELECT ID, CREATED_AT, UPDATED_AT, NAME AS USER_NAME
		FROM FEED JOIN USER ON FEED.UID = USER.UID
	    WHERE DELETED = 0 AND UID = #{uid}
	    ORDER BY ID DESC
		OFFSET #{offset}
	    LIMIT #{size}
	</select>
	
    <select id="countPosts">
        SELECT COUNT(*) 
        FROM FEED
	    WHERE DELETED = 0 AND UID = #{uid}
    </select>
	
	<select id="findById">
		SELECT *
		FROM FEED
		WHERE ID = #{id}
	</select>
	
	<select id="checkOwner">
		SELECT CASE WHEN COUNT(*) > 0 THEN TRUE ELSE FALSE END
		FROM FEED
		WHERE ID = #{id} AND UID = #{uid}
	</select>
	
	<insert id="insert" useGeneratedKeys="true">
		INSERT INTO FEED(UID, THUMBNAIL, DESCRIPTION, LATITUDE, LONGITUDE, UUID)
		VALUES (#{uid}, #{thumbnail}, #{description}, #{latitude}, #{longitude}, #{uuid})
	</insert>
	
	<update id="update">
		UPDATE FEED
		SET 
		THUMBNAIL = #{thumbnail},
		DESCRIPTION = #{description}, 
		LATITUDE = #{latitude}, 
		LONGITUDE = #{longitude}
		WHERE ID = #{id}
	</update>
	
	<update id="delete">
		UPDATE FEED
		SET DELETED = 1
		WHERE ID = #{id}
	</update>
</mapper>